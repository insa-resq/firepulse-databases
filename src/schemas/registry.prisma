model FireStation {
    id           String        @id @default(cuid(2))
    createdAt    DateTime      @default(now())
    updatedAt    DateTime      @updatedAt
    name         String
    latitude     Float
    longitude    Float
    vehicles     Vehicle[]
    firefighters Firefighter[]
    plannings    Planning[]
    users        User[]

    @@index([name])
    @@schema("registry")
}

model Vehicle {
    id             String                @id @default(cuid(2))
    createdAt      DateTime              @default(now())
    updatedAt      DateTime              @updatedAt
    type           VehicleType
    totalCount     Int
    stationId      String
    station        FireStation           @relation(fields: [stationId], references: [id], onDelete: Cascade)
    availabilities VehicleAvailability[]

    @@unique([type, stationId])
    @@schema("registry")
}

model VehicleAvailability {
    id             String   @id @default(cuid(2))
    createdAt      DateTime @default(now())
    updatedAt      DateTime @updatedAt
    weekday        Weekday
    availableCount Int      @default(0)
    bookedCount    Int      @default(0)
    vehicleId      String
    vehicle        Vehicle  @relation(fields: [vehicleId], references: [id], onDelete: Cascade)

    @@unique([vehicleId, weekday])
    @@schema("registry")
}

model Firefighter {
    id                String               @id @default(cuid(2))
    createdAt         DateTime             @default(now())
    updatedAt         DateTime             @updatedAt
    firstName         String
    lastName          String
    rank              FirefighterRank
    training          FirefighterTraining?
    stationId         String
    station           FireStation          @relation(fields: [stationId], references: [id], onDelete: Cascade)
    userId            String               @unique
    user              User                 @relation(fields: [userId], references: [id], onDelete: Cascade)
    availabilitySlots AvailabilitySlot[]
    shiftAssignments  ShiftAssignment[]

    @@index([stationId])
    @@index([rank])
    @@schema("registry")
}

model FirefighterTraining {
    id               String      @id @default(cuid(2))
    createdAt        DateTime    @default(now())
    updatedAt        DateTime    @updatedAt
    firefighterId    String      @unique
    firefighter      Firefighter @relation(fields: [firefighterId], references: [id], onDelete: Cascade)
    permitB          Boolean     @default(false) // Permis B
    permitC          Boolean     @default(false) // Permis C
    permitAircraft   Boolean     @default(false) // Permis avion
    suap             Boolean     @default(false) // Secours d'urgence aux personnes
    inc              Boolean     @default(false) // Formation lutte contre les incendies
    smallTeamLeader  Boolean     @default(false) // Chef d'équipe petit engin
    mediumTeamLeader Boolean     @default(false) // Chef d'équipe moyen engin
    largeTeamLeader  Boolean     @default(false) // Chef d'équipe gros engin

    @@schema("registry")
}

enum VehicleType {
    AMBULANCE
    CANADAIR
    SMALL_TRUCK
    MEDIUM_TRUCK
    LARGE_TRUCK
    SMALL_BOAT
    LARGE_BOAT
    HELICOPTER

    @@schema("registry")
}

enum FirefighterRank {
    SAPPER
    CORPORAL
    SERGEANT
    ADJUTANT
    LIEUTENANT
    CAPTAIN

    @@schema("registry")
}
